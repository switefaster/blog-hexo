---
title: 先前工作总结
date: 2020-06-13 17:17:01
tags:
    - CG
    - GameDev
    - Rust
---

本篇含有以下可能会引起您不适的要素：

- Rust 吹
- OpenGL 黑
- C++ 黑

若有不适应者请自行回避，请不要因为这种事造成不必要的争论。~~不过我说话也没那么绝对，如果不是真的不愿意看到我对这几个东西的倾向那还是留下看吧。~~

---

因为之前没写记录，所以在这简单总结一下之前的成果。

之前写图形的东西基本一直在用 C++ 和 DirectX。其实 DirectX 的设计挺好的，OOP 模式的设计用起来相当舒服，比 GL 的状态机高到不知道哪里去了。但是在编写的过程中，无论是 DX 本身还是 C++ 的各种特性可能造成的内存安全问题非常扎心，写起来总是感觉提心吊胆。再者 C++ 因为种种原因让人觉得非常笨重，有些功能也相当落后，而且编译起来相当的慢，编译错误也像天书，总之体验相当差。每次改点什么都要和 Linker 斗智斗勇，实属心累。于是那个坑就被我打入冷宫，碰都不想碰。

然后，救星出现了——Rust

Rust 如果做到了他宣称的那样，那么就能同时兼顾安全和高效，这显然是非常诱人的条件。实话实说，我其实一开始并不相信，将其看作一门玩具语言。其实我先前也碰过 Rust，不过由于缺乏动力所以没有学下去。这一回，因为漫长的寒假，我去正式看了一遍 [The Book](https://doc.rust-lang.org/book/)。然后我发觉，Rust 好像确实做到了如它声称的那样，高效而安全。而且由于是新生语言，没有什么包袱，无论是从语法还是到理念都相当轻盈而现代，我很喜欢。~~它那种不和当今继承多态的天下同流合污，反抗到底的精神也深得我心。~~

在这里先澄清一点。众所周知，Rust 的大部分安全保障都在编译期完成，而 Rust 也为了保证安全引入了 Ownership 机制。这导致了 Rust 非常容易造成很多意想不到的编译错误，也会导致一些设计无法使用。乍一听非常吓人，对吧？其实还好。首先，Ownership 机制这种东西其实就那么几个简单的规则，通常按着习惯来写也不会出问题；就算出问题了，Rust 的编译器是非常贴心的，会详细指出是哪里出了什么问题(比如 immutable borrow 和 mutable borrow 发生的位置)，和可以怎么样解决。一开始斗智斗勇多了以后，后面慢慢问题会越来越少。当然，它也有缺点。比如因为去除了继承多态所以能沿用 OOP 的设计模式相当有限，而且因为要靠泛型实现多态所以有些泛型边界会看着死长，不过这些要么有替代方案要么不是什么大问题，所以总体而言体验还是相当好的。

回到正题，学完 Rust 以后，我突然想到，Rust 的这些资源会不会相当不成熟？这个问题是致命的，因为首先要用图形库必须需要 FFI，而且全是 unsafe，以我个人的能力难以解决。其次很多加载之类的库如果要自己写也是非常致命的。可以发现 crates.io 上面有专门的图形库分类和游戏引擎分类，但是这些零散的库要找到合适的还是相当劳累的。这导致了我先前只知道满是 unsafe 的 [gfx-hal](https://crates.io/crates/gfx-hal/)，而 gfx_prell 又非常不对我的胃口，相当头痛。这是候我发现了[这个网站](https://arewegameyet.com/)。这个网站关注 Rust 的游戏开发产业，并收集了游戏常用的各种库。

我个人喜欢和相对底层的东西打交道，所以在经过多此碰壁后，我发现了这个图形库非常和我胃口——[Vulkano](https://crates.io/crates/vulkano)。这是 Vulkan 的 idiomatic wrapper，也就是说它保证安全，而且它提供的一些设计我非常喜欢，以后估计就用它了。

大概就先讲到这里，最后宣传一下我为了试验开的[仓库](https://github.com/switefaster/unnamed_simulator/)。~~可以看到里面有很多我和 Github Actions 对法的垃圾 commit~~

附上其 dependencies：

```toml
[dependencies]
winit = "0.22.1" # 窗口
vulkano-win = "0.19.0" # Vulkano-winit 转接用
vulkano = "0.19.0" # 图形
vulkano-shaders = "0.19.0" # Vulkano 配套的着色器宏
serde = { version = "1.0.106", features = ["derive"] } # 序列化反序列化(不会吧不会吧不会真的有人不知道 serde 吧)
nalgebra = "0.21.0" # 数学库
ncollide3d = "0.23.0" # 碰撞物理
nphysics3d = "0.15.0" # 物理
wavefront_obj = "7.0.0" # OBJ 模型加载
collada = "0.13.0" # Collada 模型加载
tokio = { version = "0.2", features = ["full"] } # 网络
futures = "0.3" # 异步实现
cpal = "0.11.0" # 声音
gilrs = "0.7.4" # 设备输入
specs = "0.16.1" # ECS
assets_manager = "0.2.2" # 资源管理
```

就是这样，后会有期，mi amigo。
